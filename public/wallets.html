<!doctype html><html><head>
<meta charset="utf-8"/><title>Wallet Management</title>
<style>
body{font-family:system-ui;margin:0;background:#f5f5f5}
.header{background:white;padding:16px 24px;border-bottom:1px solid #e5e5e5}
.main{padding:24px;max-width:1200px;margin:0 auto}
table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden}
th,td{padding:12px;text-align:left;border-bottom:1px solid #e5e5e5}
th{background:#f9fafb;font-weight:600}
button{padding:6px 12px;background:#2563eb;color:white;border:none;border-radius:4px;cursor:pointer}
.pending{color:#d97706} .verified{color:#059669}
</style>
</head><body>
<div class="header">
<h1>Wallet & Claims Management</h1>
<a href="/dashboard.html">← Back to Dashboard</a>
</div>
<div class="main">
<div style="margin-bottom:16px">
<button onclick="createTestClaim()">Create Test Claim</button>
<button onclick="refresh()">Refresh</button>
</div>
<table>
<thead><tr><th>Date</th><th>Player</th><th>Course</th><th>Hole</th><th>Status</th><th>Type</th><th>Action</th></tr></thead>
<tbody id="claims"></tbody>
</table>
</div>
<script>
const token = localStorage.getItem('token');
if (!token) location.href = '/login.html';

async function api(url, opts = {}) {
  const r = await fetch(url, {
    ...opts,
    headers: { ...opts.headers, Authorization: `Bearer ${token}` }
  });
  if (r.status === 401) location.href = '/login.html';
  return r.json();
}

async function refresh() {
  const {claims} = await api('/api/admin/claims');
  document.getElementById('claims').innerHTML = claims.map(c => `
    <tr>
      <td>${new Date(c.created_at).toLocaleDateString()}</td>
      <td>${c.player_first} ${c.player_last}</td>
      <td>${c.course_id}</td>
      <td>${c.hole || ''}</td>
      <td class="${c.status}">${c.status}</td>
      <td>${c.status === 'pending' ? `<button onclick="verify('${c.claim_id}')">Verify & Credit $65</button>` : '✓'}</td>
    </tr>
  `).join('');
}

async function createTestClaim() {
  await fetch('/api/claims/webhook', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      first_name: 'Test',
      last_name: 'Player',
      course_id: 'wentworth-gc',
      hole: '4'
    })
  });
  refresh();
}

async function verify(id) {
  await api(`/api/claims/${id}/verify`, {method: 'POST'});
  refresh();
}

refresh();
</script>
</body></html>
